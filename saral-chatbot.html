<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="description" content="Saral Sathi — Haryana SARAL Chatbot Assistant" />
  <meta name="theme-color" content="#7a1f3d" />
  <title>Saral Sathi — SARAL Chatbot</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@400;600;700&family=Karma:wght@600;700&display=swap" rel="stylesheet">

  <!-- Inline favicon (maroon robot) -->
  <link rel="icon" type="image/svg+xml"
        href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" stroke="%237a1f3d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="8" width="16" height="10" rx="2" ry="2"/><path d="M12 2v4"/><circle cx="8.5" cy="13" r="1"/><circle cx="15.5" cy="13" r="1"/><path d="M8 18h8"/></g></svg>'>

  <style>
    :root{ --maroon:#7a1f3d; --maroon-dark:#5a0f25; --rose:#f8eef1; --border:#ead5dc; }
    html { font-size: 15px; }
    body { margin:0; font-family: "Mukta", system-ui, Arial, sans-serif; background:#f8eef1; color:#3b2a30; }
    header { display:flex; gap:12px; align-items:center; padding:12px 16px; border-bottom:1px solid var(--border); background:#fff; }
    header img { height:36px; }
    header h1 { font: 700 1rem/1.2 "Karma", Georgia, serif; color:var(--maroon); display:flex; align-items:center; gap:8px; }
    main { padding: 12px 16px; color:#4a3a40; }
    code { background:#fff; padding:2px 6px; border-radius:4px; border:1px solid var(--border); }
    .bot-icon{ width:18px; height:18px; display:inline-block; }
  </style>
</head>
<body>
  <header>
    <img src="./saral-logo.png" alt="SARAL"/>
    <h1>
      <svg class="bot-icon" viewBox="0 0 24 24" aria-hidden="true">
        <circle cx="12" cy="12" r="10" fill="#7a1f3d"/>
        <circle cx="9" cy="11" r="1.6" fill="#fff"/>
        <circle cx="15" cy="11" r="1.6" fill="#fff"/>
        <rect x="7.5" y="14" width="9" height="1.8" rx="0.9" fill="#fff"/>
        <rect x="11.2" y="3.2" width="1.6" height="3" rx="0.8" fill="#7a1f3d"/>
      </svg>
      Saral Sathi — Chatbot (Production)
    </h1>
  </header>

  <main>
    Try asking for: 
    <code>resident certificate</code>, 
    <code>caste certificate</code>, 
    <code>income certificate</code>, 
    <code>migration certificate</code>.
  </main>

  <div id="chat-holder"></div>

<script>
  /* =====================
     Load Rasa Webchat
  ===================== */
  function ensureWebchatLib(cb){
    if (window.WebChat && window.WebChat.default) return cb();
    const script = document.createElement("script");
    script.src = "https://cdn.jsdelivr.net/npm/rasa-webchat/lib/index.min.js?v=20251008-1";
    script.async = true;
    script.onload = cb;
    document.body.appendChild(script);
  }

  function injectSaralTheme(){
    const plane = 'data:image/svg+xml;utf8,' + encodeURIComponent(
      `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fff" d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"/></svg>`
    );
    const css = `
      .rw-widget-container, .rw-conversation-container, .rw-messages-container,
      .rw-sender, .rw-reply, .rw-message .rw-message-text {
        font-family: "Mukta", system-ui, Arial, sans-serif !important;
      }
      .rw-conversation-container .rw-title {
        font-family: "Karma", Georgia, serif !important;
        font-weight: 700 !important; font-size: 1.06rem !important;
        color:#fff !important; display:flex; align-items:center; gap:8px;
      }
      .rw-conversation-container .rw-message .rw-message-text {
        font-size: .97rem !important; line-height: 1.35 !important;
      }
      .rw-conversation-container .rw-reply {
        font-size: .9rem !important;
        background:#fff !important; color:#7a1f3d !important;
        border:1px solid #7a1f3d !important;
        box-shadow:0 3px 8px rgba(122,31,61,.12)!important;
      }
      .rw-conversation-container .rw-reply:hover{ background:#f8eef1!important; }
      .rw-launcher{background-color:#7a1f3d!important; box-shadow:0 6px 18px rgba(122,31,61,.3)!important;}
      .rw-launcher:hover{background-color:#5a0f25!important;}
      .rw-conversation-container .rw-header{ background:linear-gradient(135deg,#5a0f25,#7a1f3d)!important; }
      .rw-conversation-container .rw-message.rw-client .rw-message-text{
        background:#eed7df!important; color:#36111d!important; border:1px solid #e6c3ce!important;
      }
      .rw-conversation-container .rw-message.rw-response .rw-message-text{
        background:#ffffff!important; color:#3b2a30!important; border:1px solid #f0e2e7!important;
      }
      .rw-conversation-container .rw-sender{ border-top:1px solid #ead5dc!important; background:#fff!important; }
      .rw-badge{ background:#7a1f3d!important; }
      .rw-conversation-container .rw-send{
        background-color:#7a1f3d!important; border-radius:6px!important;
        width:36px!important; height:36px!important; position:relative!important;
      }
      .rw-conversation-container .rw-send .rw-send-icon{ display:none!important; }
      .rw-conversation-container .rw-send::after{
        content:""; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
        width:18px; height:18px; background-image:url('${plane}');
        background-repeat:no-repeat; background-position:center; background-size:18px 18px;
      }
    `;
    const el = document.createElement('style');
    el.id = 'saral-theme';
    el.appendChild(document.createTextNode(css));
    document.head.appendChild(el);
  }

  function loadChat() {
    ensureWebchatLib(() => {
      window.WebChat.default(
        {
          initPayload: "/greet",
          customData: { language: "en" },
          socketUrl: "http://3.7.46.136:5005",
          socketPath: "/socket.io/",
          title: "Saral Sathi",
          subtitle: "Haryana SARAL Assistant",
          showCloseButton: true,
          showFullScreenButton: true,
          params: { storage: "none" },
          onSocketEvent: {
            connect_error: () => console.warn("⚠️ Socket connection failed – retrying..."),
            disconnect: () => console.warn("⚠️ Socket disconnected")
          }
        },
        null
      );
      injectSaralTheme();
    });
  }

  loadChat();
</script>

</body>
</html>
