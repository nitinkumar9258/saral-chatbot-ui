<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SARAL Chatbot</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: #fafafa;
    }
    header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 14px;
      border-bottom: 1px solid #eee;
      background: #fff;
    }
    header h1 {
      font-size: 20px;
      color: #7a1814;
      margin: 0;
      font-weight: 600;
    }

    /* Floating chat theming */
    .rw-launcher { background-color: #f28c2f !important; }
    .rw-conversation-container .rw-header {
      background-color: #f28c2f !important;
      color: #fff !important;
    }
    .rw-message.rw-client {
      background-color: #7a1814 !important;
      color: #fff !important;
    }
    .rw-message.rw-response {
      background-color: #f1f1f1 !important;
      color: #222 !important;
    }
    .rw-conversation-container .rw-new-message {
      border-top: 1px solid #ddd !important;
    }
  </style>

  <!-- Rasa Webchat stable build -->
  <script
    src="https://cdn.jsdelivr.net/npm/rasa-webchat@1.0.1/lib/index.min.js"
    crossorigin="anonymous"
  ></script>
</head>

<body>
  <header>
    <!-- Inline SARAL mini logo -->
    <svg width="42" height="42" viewBox="0 0 128 128" aria-hidden="true">
      <rect width="128" height="128" fill="#f28c2f"></rect>
      <text
        x="50%" y="58%"
        font-family="Arial, sans-serif"
        font-size="46"
        fill="#ffffff"
        text-anchor="middle"
        dominant-baseline="middle"
      >S</text>
    </svg>
    <h1>SARAL Chatbot</h1>
  </header>

  <script>
    // Build inline avatar
    const avatarSvg =
      "<svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'>" +
      "<rect width='128' height='128' fill='#f28c2f'/>" +
      "<text x='50%' y='58%' font-family='Arial,sans-serif' font-size='40' fill='#ffffff' text-anchor='middle' dominant-baseline='middle'>SARAL</text></svg>";
    const avatarDataUrl = "data:image/svg+xml;utf8," + encodeURIComponent(avatarSvg);

    const socketUrl  = "https://saral-chatbot-server.onrender.com";
    const socketPath = "/socket.io/";

    function initRasaChat() {
      window.WebChat.default.init({
        initPayload: "/greet",
        socketUrl,
        socketPath,
        title: "SARAL Chatbot",
        subtitle: "Ask about Haryana Government Services",
        mainColor: "#f28c2f",
        userBackgroundColor: "#7a1814",
        userTextColor: "#ffffff",
        profileAvatar: avatarDataUrl,
        embedded: false,  // floating widget
        showFullScreenButton: true,
        params: { storage: "session" },
      });
      console.log("‚úÖ Rasa Webchat initialized");
    }

    function waitForWebChat() {
      if (window.WebChat?.default?.init) {
        initRasaChat();
      } else {
        console.log("‚è≥ Waiting for rasa-webchat script...");
        setTimeout(waitForWebChat, 400);
      }
    }

    window.addEventListener("load", () => {
      console.log("üåê Page loaded, waiting for rasa-webchat...");
      waitForWebChat();
    });
  </script>
</body>
</html>
