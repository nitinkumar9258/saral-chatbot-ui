<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SARAL Haryana Chatbot</title>

  <!-- Base theme styles -->
  <style>
    body {
      margin: 0;
      font-family: "Roboto", "Open Sans", Arial, sans-serif;
      background-color: #f7f7f7;
      color: #333;
    }

    header {
      display: flex;
      align-items: center;
      gap: 12px;
      background: linear-gradient(90deg, #cc0000 0%, #b00000 100%);
      color: #fff;
      padding: 10px 16px;
      border-bottom: 3px solid #e6b800;
    }

    header img {
      height: 40px;
    }

    header h1 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
      letter-spacing: 0.3px;
    }

    main {
      padding: 14px 16px;
      text-align: center;
      background: #fff;
      border-bottom: 1px solid #ddd;
    }

    main h2 {
      margin: 10px 0 4px;
      color: #b00000;
      font-weight: 600;
    }

    main p {
      color: #555;
      font-size: 14px;
    }

    code {
      background: #f0f0f0;
      padding: 2px 4px;
      border-radius: 4px;
    }

    /* --- Chat widget color overrides --- */
    .rw-launcher {
      background-color: #b00000 !important; /* SARAL red */
    }

    .rw-conversation-container .rw-header {
      background-color: #b00000 !important;
      color: #fff !important;
      border-bottom: 2px solid #e6b800 !important;
    }

    .rw-conversation-container .rw-header .rw-title {
      font-weight: 700;
      color: #fff !important;
    }

    .rw-client {
      background-color: #ffeaea !important;
      color: #111 !important;
    }

    .rw-response {
      background-color: #b00000 !important;
      color: #fff !important;
    }

    .rw-send {
      background-color: #b00000 !important;
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 13px;
      color: #666;
      background: #fafafa;
      border-top: 1px solid #eee;
    }
  </style>
</head>

<body>
  <header>
    <img src="https://saralharyana.gov.in/images/saral_logo.png" alt="SARAL Logo" />
    <h1>SARAL Haryana Chatbot</h1>
  </header>

  <main>
    <h2>Welcome to SARAL Chatbot ðŸ¤–</h2>
    <p>
      Get instant help about Haryana Government services and certificates.<br/>
      Try typing <code>resident certificate</code>, <code>income certificate</code>,
      or <code>electricity connection</code>.
    </p>
  </main>

  <div id="chat-holder"></div>

  <footer>Â© 2025 Citizen Resources Information Department (CRID), Government of Haryana</footer>

  <script>
    // === Load and reload chat ===
    function loadChat() {
      const old = document.getElementById("webchat");
      if (old) old.remove();

      const script = document.createElement("script");
      script.src = "https://cdn.jsdelivr.net/npm/rasa-webchat/lib/index.min.js";
      script.async = true;
      script.onload = () => {
        window.WebChat.default(
          {
            initPayload: "/greet",
            customData: { language: "en" },
            socketUrl: "https://saral-chatbot-server.onrender.com",
            socketPath: "/socket.io/",
            title: "SARAL Chatbot",
            subtitle: "Ask about any Haryana Service",
            showCloseButton: true,
            showFullScreenButton: true,
            params: { storage: "none" },
            inputTextFieldHint: "Type your query here..."
          },
          null
        );
        console.log("âœ… Chat widget loaded fresh");
        setTimeout(watchMinimize, 800);
      };
      document.body.appendChild(script);
    }

    // === Reload chat when minimized (clears state) ===
    function watchMinimize() {
      const launcher = document.querySelector(".rw-launcher");
      const panel = document.querySelector(".rw-conversation-container");
      if (!launcher || !panel) return setTimeout(watchMinimize, 500);

      let lastVisible = true;

      const observer = new MutationObserver(() => {
        const isVisible = panel.style.display !== "none" && panel.offsetParent !== null;
        if (lastVisible && !isVisible) {
          console.log("ðŸ”„ Chat minimized â€” clearing and reloading");
          try {
            localStorage.clear();
            sessionStorage.clear();
          } catch (e) {}
          const old = document.getElementById("webchat");
          if (old) old.remove();
          loadChat();
        }
        lastVisible = isVisible;
      });

      observer.observe(panel, { attributes: true, attributeFilter: ["style"] });
    }

    loadChat();
  </script>
</body>
</html>
